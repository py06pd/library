<div>
    <div id="controls">
        <el-button type="primary" icon="plus" @click="openAdd">Add Entry</el-button>
        <el-button type="primary" icon="delete" @click="deleteItems">Delete Selected</el-button>
        <el-button type="primary" icon="plus" @click="addFilter">Add Filter</el-button>

        <el-select
            v-model="filter.field"
            placeholder="Please select a field"
            @change="filterFieldChange">
            <el-option v-for="field in fields" :label="field" :value="field"></el-option>
        </el-select>

        <el-select
            v-model="filter.operator"
            placeholder="Please select a operator">
            <el-option v-for="operator in operators" :label="operator" :value="operator"></el-option>
        </el-select>

        <el-select
            v-model="filter.value"
            filterable
            placeholder="Please select a value">
            <el-option v-for="(label, value) in values" :label="label" :value="value"></el-option>
        </el-select>
    </div>
    <div style="margin-bottom:10px">
        <el-tag
            v-for="(filter, filterIndex) in filters"
            :closable="true"
            type="primary"
            :close-transition="false"
            @close="removeFilter(filterIndex)">
            <template v-if="['owner','read'].indexOf(filter.field) != -1">
                {{ filter.field }} {{ filter.operator }} '{{ $root.users[filter.value].name }}'
            </template>
            <template v-else>
                {{ filter.field }} {{ filter.operator }} '{{ filter.value }}'
            </template>
        </el-tag>
    </div>
    
    <el-table class="cic-table"
        :data="books"
        highlight-current-row
        @selection-change="onRowSelected"
        height="600">
        <el-table-column
            type="selection">
        </el-table-column>
        <el-table-column
            width="50">
            <template scope="scope">
                <el-button size="small" icon="menu" @click="openMenu(scope.row)"></el-button>
            </template>
        </el-table-column>
        <el-table-column
            prop="name"
            label="Title">
        </el-table-column>
        <el-table-column
            prop="type"
            label="Type">
        </el-table-column>
        <el-table-column
            prop="authors"
            label="Author">
        </el-table-column>
        <el-table-column
            prop="genres"
            label="Genre">
        </el-table-column>
        <el-table-column
            prop="series"
            label="Series">
        </el-table-column>
        <el-table-column
            prop="ownerNames"
            label="Owner"
            width="100">
        </el-table-column>
        <el-table-column
            prop="read"
            label="Read"
            width="100">
        </el-table-column>  
    </el-table>
    
    <el-dialog id="bookMenu" :visible.sync="menuOpen">
        <el-button @click="openEdit">Edit</el-button>
        <template v-if="$root.user.id > 0 && editing.id > 0 && editing.owners.indexOf($root.user.id) == -1">
            <template v-if="editing.owners.length > 0">
                <br><el-button @click="borrowRequest">Borrow Request</el-button>
            </template>
            <br><el-button @click="wishlist">Add to Wishlist</el-button>
        </template>
    </el-dialog>
    
    <el-dialog id="frmBook" title="Edit Book" v-if="formOpen" :visible.sync="formOpen">
        <el-form :model="editing">
            <el-form-item label="Title">
                <el-input class="name" v-model="editing.name"></el-input>
            </el-form-item>
            <el-form-item label="Type">
                <el-select
                    allow-create
                    filterable
                    v-model="editing.type"
                    placeholder="Please select a type">
                    <el-option v-for="type in types" :label="type" :value="type"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="Authors">
                <el-select
                    allow-create
                    filterable
                    multiple
                    v-model="editing.authors"
                    placeholder="Please select a author">
                    <el-option v-for="author in authors" :label="author" :value="author"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="Genres">
                <el-select
                    allow-create
                    filterable
                    multiple
                    v-model="editing.genres"
                    placeholder="Please select a genre">
                    <el-option v-for="genre in genres" :label="genre" :value="genre"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="Series">
                <ul id="selSeries">                  
                    <li v-for="current in editing.series">
                        <el-select
                            allow-create
                            clearable
                            filterable
                            v-model="current.name"
                            placeholder="Please select a series"
                            @change="seriesChange">
                            <el-option v-for="serie in series" :label="serie" :value="serie"></el-option>
                        </el-select>
                        <el-input class="series-number" v-model="current.number"></el-input>
                    </li>
                    <li>
                        <el-select
                            allow-create
                            clearable
                            filterable
                            v-model="newSeries.name"
                            placeholder="Please select a series"
                            @change="seriesChange">
                            <el-option v-for="serie in series" :label="serie" :value="serie"></el-option>
                        </el-select>
                        <el-input class="series-number" v-model="newSeries.number"></el-input>
                    </li>
                </ul>
            </el-form-item>
            <el-form-item label="Owners">
                <el-select
                    multiple
                    v-model="editing.owners"
                    placeholder="Please select a person">
                    <el-option v-for="user in $root.users" :label="user.name" :value="user.id"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="Read">
                <el-select
                    multiple
                    v-model="editing.read"
                    placeholder="Please select a person">
                    <el-option v-for="user in $root.users" :label="user.name" :value="user.id"></el-option>
                </el-select>
            </el-form-item>
        </el-form>
        <span slot="footer" class="dialog-footer">
            <el-button type="primary" @click="saveItem(true)">Save and Close</el-button>
            <el-button v-if="editing.id === -1" type="primary" @click="saveItem(false)">Save</el-button>
            <el-button @click="formOpen = false">Cancel</el-button>
        </span>
    </el-dialog>
</div>
